<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FireGuard - ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆæ·±åº¦è¨ˆ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { background-color: #020617; color: #e2e8f0; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Inline SVG for standalone usage) ---
        const Icon = ({ name, className = "" }) => {
            const icons = {
                AlertTriangle: <><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></>,
                ShieldAlert: <><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>,
                Mic: <><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></>,
                Camera: <><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></>,
                Users: <><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></>,
                Save: <><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>,
                RefreshCw: <><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></>,
                Siren: <><path d="M7 18v-6a5 5 0 1 1 10 0v6"/><path d="M5 21a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2"/><path d="M21 12h1"/><path d="M2 12h1"/></>,
                Flame: <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-2.246-3.77-3-5.228A9.773 9.773 0 0 0 6 2a9.77 9.77 0 0 0 9.254 6.746c-.524 1.458-1.554 2.87-3.754 5.254A2.5 2.5 0 0 1 9 12a2.5 2.5 0 0 0-2.5 2.5z"/>,
                FileText: <><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></>,
                Activity: <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>,
                Lock: <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>,
                Settings: <><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></>,
                User: <><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>,
                UserX: <><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="18" y1="8" x2="23" y2="13"/><line x1="23" y1="8" x2="18" y2="13"/></>,
                Key: <><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-1.77-1.77 5.5 5.5 0 0 1 1.77 1.77zm0 0L15 9l2 2 2-2"/></>,
                LogOut: <><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></>,
                Check: <polyline points="20 6 9 17 4 12"/>,
                Download: <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></>,
                Trash2: <><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></>,
                X: <><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>,
                HelpCircle: <><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></>
            };

            return (
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width="24" height="24" 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round" 
                    className={className}
                >
                    {icons[name] || <circle cx="12" cy="12" r="10"/>}
                </svg>
            );
        };

        // --- Components ---

        const Card = ({ children, className = "" }) => (
            <div className={`bg-slate-800 rounded-xl border border-slate-700 shadow-xl overflow-hidden ${className}`}>
                {children}
            </div>
        );

        const Button = ({ onClick, children, variant = "primary", className = "", disabled = false, type = "button" }) => {
            const baseStyle = "px-4 py-2 rounded-lg font-bold transition-all duration-200 flex items-center justify-center gap-2 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed";
            const variants = {
                primary: "bg-orange-600 hover:bg-orange-500 text-white shadow-lg shadow-orange-900/50",
                secondary: "bg-slate-600 hover:bg-slate-500 text-white",
                danger: "bg-red-600 hover:bg-red-500 text-white shadow-lg shadow-red-900/50",
                outline: "border-2 border-slate-500 text-slate-300 hover:bg-slate-700",
                ghost: "bg-transparent text-slate-400 hover:text-white"
            };
            return (
                <button type={type} onClick={onClick} className={`${baseStyle} ${variants[variant]} ${className}`} disabled={disabled}>
                    {children}
                </button>
            );
        };

        const Input = ({ label, value, onChange, placeholder, type = "text" }) => (
            <div className="mb-3">
                {label && <label className="block text-xs text-slate-400 mb-1">{label}</label>}
                <input 
                    type={type}
                    value={value}
                    onChange={onChange}
                    placeholder={placeholder}
                    className="w-full bg-slate-950 border border-slate-700 rounded-lg p-3 text-sm focus:outline-none focus:border-orange-500 transition-colors text-slate-200"
                />
            </div>
        );

        const Gauge = ({ value, max, color, label, icon, description }) => {
            const percentage = Math.min((value / max) * 100, 100);
            const isCritical = value >= max;
            
            const getColor = () => {
                if (color === 'red') {
                    return isCritical ? 'text-red-500 drop-shadow-[0_0_10px_rgba(239,68,68,0.8)]' : 'text-red-400';
                }
                return isCritical ? 'text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.8)]' : 'text-slate-400';
            };

            const barColor = color === 'red' 
                ? (isCritical ? 'bg-red-600 animate-pulse' : 'bg-gradient-to-r from-orange-500 to-red-600')
                : (isCritical ? 'bg-yellow-500 animate-pulse' : 'bg-gradient-to-r from-slate-500 to-slate-300');

            return (
                <div className="w-full p-4 bg-slate-900/50 rounded-lg border border-slate-700 relative overflow-hidden">
                    {isCritical && (
                        <div className="absolute inset-0 bg-red-500/10 z-0 animate-pulse pointer-events-none"></div>
                    )}
                    <div className="flex justify-between items-center mb-2 z-10 relative">
                        <div className="flex items-center gap-2">
                            <Icon name={icon} className={`w-6 h-6 ${getColor()}`} />
                            <span className="font-bold text-slate-200">{label}</span>
                        </div>
                        <span className={`text-2xl font-black ${getColor()}`}>
                            {value} <span className="text-sm font-normal text-slate-500">/ {max}</span>
                        </span>
                    </div>
                    
                    <div className="h-6 bg-slate-800 rounded-full overflow-hidden border border-slate-600 relative">
                        <div className="absolute inset-0 flex justify-between px-1 items-center z-10">
                            {[...Array(max)].map((_, i) => (
                                <div key={i} className={`w-0.5 h-full ${i % 5 === 0 ? 'bg-slate-900/50' : 'bg-transparent'}`}></div>
                            ))}
                        </div>
                        <div 
                            className={`h-full transition-all duration-500 ease-out ${barColor}`}
                            style={{ width: `${percentage}%` }}
                        ></div>
                    </div>
                    
                    <p className="text-xs text-slate-400 mt-2 h-4 truncate">{description}</p>
                </div>
            );
        };

        // --- Tutorial Animation ---
        const TutorialAnimation = () => (
            <div className="w-full bg-slate-900 rounded-xl overflow-hidden border border-slate-700 p-4">
                <svg viewBox="0 0 300 120" className="w-full h-auto">
                    <defs>
                        <style>{`
                            .tut-icon { fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
                            .tut-lock { stroke: #cbd5e1; animation: anim-lock 4s infinite; transform-origin: 50px 40px; }
                            .tut-shackle { stroke: #cbd5e1; animation: anim-shackle 4s infinite; transform-origin: 50px 30px; }
                            .tut-meter-bg { fill: #334155; }
                            .tut-meter-fill { fill: #f97316; width: 0; animation: anim-meter 4s infinite; }
                            .tut-doc { stroke: #cbd5e1; opacity: 0; animation: anim-doc 4s infinite; transform-origin: 250px 60px; }
                            .tut-text { font-size: 10px; fill: #94a3b8; text-anchor: middle; font-family: sans-serif; font-weight: bold; }
                            .tut-step { opacity: 0.3; transition: opacity 0.5s; }
                            .tut-arrow { stroke: #475569; stroke-width: 2; stroke-dasharray: 4; animation: anim-dash 1s linear infinite; }
                            
                            @keyframes anim-lock { 
                                0%, 25% { transform: scale(1); stroke: #cbd5e1; } 
                                5%, 20% { transform: rotate(-5deg); } 
                                10%, 15% { transform: rotate(5deg); }
                                30% { stroke: #475569; }
                            }
                            @keyframes anim-shackle {
                                0%, 10% { transform: translateY(0); }
                                15%, 25% { transform: translateY(-5px); }
                                30% { transform: translateY(0); }
                            }
                            @keyframes anim-meter {
                                0%, 25% { width: 0; }
                                30% { width: 0; }
                                45% { width: 40px; fill: #f97316; }
                                60% { width: 70px; fill: #ef4444; }
                                100% { width: 70px; fill: #ef4444; }
                            }
                            @keyframes anim-doc {
                                0%, 60% { opacity: 0; transform: translateY(10px); }
                                70%, 90% { opacity: 1; transform: translateY(0); stroke: #fff; }
                                100% { opacity: 0; }
                            }
                            @keyframes anim-dash { to { stroke-dashoffset: -8; } }
                            
                            .highlight-1 { animation: h1 4s infinite; }
                            .highlight-2 { animation: h2 4s infinite; }
                            .highlight-3 { animation: h3 4s infinite; }
                            
                            @keyframes h1 { 0%, 25% { opacity: 1; fill: #fff; } 30%, 100% { opacity: 0.3; fill: #94a3b8; } }
                            @keyframes h2 { 0%, 25% { opacity: 0.3; fill: #94a3b8; } 30%, 60% { opacity: 1; fill: #f97316; } 65%, 100% { opacity: 0.3; fill: #94a3b8; } }
                            @keyframes h3 { 0%, 60% { opacity: 0.3; fill: #94a3b8; } 65%, 90% { opacity: 1; fill: #fff; } 100% { opacity: 0.3; fill: #94a3b8; } }
                        `}</style>
                    </defs>

                    <g transform="translate(50, 40)">
                        <path d="M-10 0 H10 V14 H-10 Z" className="tut-icon tut-lock" />
                        <path d="M-7 0 V-7 A7 7 0 0 1 7 -7 V0" className="tut-icon tut-shackle" fill="none" />
                    </g>
                    <text x="50" y="80" className="tut-text highlight-1">1.ä¿è­·</text>

                    <line x1="80" y1="50" x2="120" y2="50" className="tut-arrow" />

                    <g transform="translate(150, 50)">
                        <rect x="-40" y="-10" width="80" height="20" rx="4" className="tut-meter-bg" />
                        <rect x="-40" y="-10" width="0" height="20" rx="4" className="tut-meter-fill" />
                        <path d="M-40 -10 V10" stroke="#1e293b" strokeWidth="1" />
                        <path d="M-20 -10 V10" stroke="#1e293b" strokeWidth="1" />
                        <path d="M0 -10 V10" stroke="#1e293b" strokeWidth="1" />
                        <path d="M20 -10 V10" stroke="#1e293b" strokeWidth="1" />
                    </g>
                    <text x="150" y="80" className="tut-text highlight-2">2.è¨˜éŒ²ãƒ»è“„ç©</text>

                    <line x1="200" y1="50" x2="230" y2="50" className="tut-arrow" />

                    <g transform="translate(250, 40)">
                        <path d="M-10 -14 H0 L10 -4 V14 H-10 Z" className="tut-icon tut-doc" />
                        <path d="M-5 -6 H5 M-5 0 H5 M-5 6 H0" className="tut-icon tut-doc" strokeWidth="1" />
                    </g>
                    <text x="250" y="80" className="tut-text highlight-3">3.å‡ºåŠ›ãƒ»è§£æ±º</text>
                </svg>
            </div>
        );

        // --- Custom Modal ---
        const Modal = ({ isOpen, title, message, children, type = 'normal', onConfirm, onCancel, showCancel = true, confirmText = "å®Ÿè¡Œã™ã‚‹" }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200">
                    <Card className="w-full max-w-sm p-0 border-2 border-slate-600">
                        <div className={`p-4 border-b ${type === 'danger' ? 'bg-red-900/50 border-red-800' : 'bg-slate-800 border-slate-700'} flex justify-between items-center`}>
                            <h3 className={`font-bold ${type === 'danger' ? 'text-red-100' : 'text-white'}`}>{title}</h3>
                            <button onClick={onCancel} className="text-slate-400 hover:text-white"><Icon name="X" className="w-5 h-5" /></button>
                        </div>
                        <div className="p-6 bg-slate-900">
                            {children ? children : <p className="text-sm text-slate-300 whitespace-pre-wrap leading-relaxed">{message}</p>}
                        </div>
                        <div className="p-4 bg-slate-800 border-t border-slate-700 flex gap-3">
                            {showCancel && <Button onClick={onCancel} variant="secondary" className="flex-1">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</Button>}
                            <Button onClick={onConfirm} variant={type === 'danger' ? 'danger' : 'primary'} className="flex-1">{confirmText}</Button>
                        </div>
                    </Card>
                </div>
            );
        };

        // --- Custom Toast ---
        const Toast = ({ message, show, onClose }) => {
            useEffect(() => {
                if (show) {
                    const timer = setTimeout(onClose, 3000);
                    return () => clearTimeout(timer);
                }
            }, [show, onClose]);

            if (!show) return null;

            return (
                <div className="fixed top-4 left-1/2 -translate-x-1/2 z-[110] bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl border border-slate-600 flex items-center gap-2 animate-in slide-in-from-top-5 fade-in">
                    <Icon name="Check" className="w-4 h-4 text-green-400" />
                    <span className="text-sm font-bold">{message}</span>
                </div>
            );
        };

        // --- MAIN APP ---

        function App() {
            // State
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [hasSetup, setHasSetup] = useState(false);
            const [savedKeyword, setSavedKeyword] = useState(null);
            
            const [activeTab, setActiveTab] = useState('meter'); 
            const [redScore, setRedScore] = useState(0);
            const [greyScore, setGreyScore] = useState(0);
            const [logs, setLogs] = useState([]);
            
            const [victimName, setVictimName] = useState('');
            const [perpetrators, setPerpetrators] = useState(['']); 

            const [inputKeyword, setInputKeyword] = useState('');
            const [setupKeyword, setSetupKeyword] = useState('');
            const [setupError, setSetupError] = useState('');
            
            const [showInput, setShowInput] = useState(false);
            const [incidentType, setIncidentType] = useState('grey');
            const [description, setDescription] = useState('');
            const [intensity, setIntensity] = useState(1);
            const [selectedPerpetrator, setSelectedPerpetrator] = useState('');
            const [hasAudio, setHasAudio] = useState(false);
            const [hasPhoto, setHasPhoto] = useState(false);
            const [hasWitness, setHasWitness] = useState(false);
            const [witnessNameInput, setWitnessNameInput] = useState('');

            const [modalConfig, setModalConfig] = useState({ isOpen: false, title: '', message: '', type: 'normal', onConfirm: () => {}, showCancel: true, confirmText: 'å®Ÿè¡Œã™ã‚‹' });
            const [showTutorial, setShowTutorial] = useState(false);
            const [toastConfig, setToastConfig] = useState({ show: false, message: '' });

            // Effects
            useEffect(() => {
                const storedKeyword = localStorage.getItem('fireguard_keyword');
                const storedLogs = JSON.parse(localStorage.getItem('fireguard_logs') || '[]');
                const storedRed = Number(localStorage.getItem('fireguard_red') || 0);
                const storedGrey = Number(localStorage.getItem('fireguard_grey') || 0);
                const storedVictim = localStorage.getItem('fireguard_victim') || '';
                const storedPerps = JSON.parse(localStorage.getItem('fireguard_perps') || '[""]');

                if (storedKeyword) {
                    setSavedKeyword(storedKeyword);
                    setHasSetup(true);
                }
                
                setLogs(storedLogs);
                setRedScore(storedRed);
                setGreyScore(storedGrey);
                setVictimName(storedVictim);
                setPerpetrators(storedPerps);
            }, []);

            useEffect(() => {
                if (isAuthenticated) {
                    localStorage.setItem('fireguard_logs', JSON.stringify(logs));
                    localStorage.setItem('fireguard_red', redScore);
                    localStorage.setItem('fireguard_grey', greyScore);
                    localStorage.setItem('fireguard_victim', victimName);
                    localStorage.setItem('fireguard_perps', JSON.stringify(perpetrators));
                }
            }, [logs, redScore, greyScore, victimName, perpetrators, isAuthenticated]);

            // Helpers
            const showToast = (message) => { setToastConfig({ show: true, message }); };
            const closeModal = () => { setModalConfig(prev => ({ ...prev, isOpen: false })); };
            const showConfirm = (title, message, type, onConfirm) => {
                setModalConfig({
                    isOpen: true, title, message, type, showCancel: true, confirmText: 'å®Ÿè¡Œã™ã‚‹',
                    onConfirm: () => { onConfirm(); closeModal(); }
                });
            };

            // Handlers
            const handleSetup = () => {
                if (setupKeyword.length < 4) {
                    setSetupError("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯4æ–‡å­—ä»¥ä¸Šã§è¨­å®šã—ã¦ãã ã•ã„");
                    return;
                }
                localStorage.setItem('fireguard_keyword', setupKeyword);
                setSavedKeyword(setupKeyword);
                setHasSetup(true);
                setIsAuthenticated(true);
                setActiveTab('settings');
                setShowTutorial(true);
            };

            const handleLogin = () => {
                if (inputKeyword === savedKeyword) {
                    setIsAuthenticated(true);
                    setInputKeyword('');
                } else {
                    setSetupError("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
                    setTimeout(() => setSetupError(""), 2000);
                    const input = document.getElementById('login-input');
                    if(input) {
                        input.classList.add('animate-pulse', 'border-red-500');
                        setTimeout(() => input.classList.remove('animate-pulse', 'border-red-500'), 500);
                    }
                }
            };

            const handleLogout = () => { setIsAuthenticated(false); setActiveTab('meter'); };
            const handleAddPerpetrator = () => { setPerpetrators([...perpetrators, '']); };
            const handlePerpetratorChange = (index, value) => {
                const newPerps = [...perpetrators];
                newPerps[index] = value;
                setPerpetrators(newPerps);
            };
            const handleRemovePerpetrator = (index) => {
                const newPerps = perpetrators.filter((_, i) => i !== index);
                setPerpetrators(newPerps.length ? newPerps : ['']);
            };

            const handleSubmitLog = () => {
                const newLog = {
                    id: Date.now(),
                    date: new Date().toLocaleString('ja-JP'),
                    type: incidentType,
                    points: Number(intensity),
                    description,
                    perpetrator: selectedPerpetrator || 'ä¸æ˜/æœªé¸æŠ',
                    evidence: { hasAudio, hasPhoto, hasWitness, witnessName: witnessNameInput }
                };

                setLogs([newLog, ...logs]);
                if (incidentType === 'red') setRedScore(prev => Math.min(prev + Number(intensity), 10));
                else setGreyScore(prev => Math.min(prev + Number(intensity), 20));

                setDescription('');
                setIntensity(1);
                setSelectedPerpetrator('');
                setHasAudio(false);
                setHasPhoto(false);
                setHasWitness(false);
                setWitnessNameInput('');
                setShowInput(false);
                
                if (navigator.vibrate) navigator.vibrate(200);
                showToast("è¨˜éŒ²ã‚’è¿½åŠ ã—ã¾ã—ãŸ");
            };

            const handleResetData = () => {
                showConfirm("è¨˜éŒ²ã®ãƒªã‚»ãƒƒãƒˆ", "ç¾åœ¨ã®ã€Œãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆæ·±åº¦ãƒ¡ãƒ¼ã‚¿ãƒ¼ã€ã¨ã€Œå±¥æ­´ãƒ­ã‚°ã€ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\n\nâ€»åç°¿è¨­å®šã¨ãƒ­ã‚°ã‚¤ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ä¿æŒã•ã‚Œã¾ã™ã€‚", "warning", () => {
                    setRedScore(0);
                    setGreyScore(0);
                    setLogs([]);
                    showToast("è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
                });
            };

            const handleFactoryReset = () => {
                showConfirm("ã‚¢ãƒ—ãƒªå®Œå…¨åˆæœŸåŒ–", "ã€è­¦å‘Šã€‘\nã‚¢ãƒ—ãƒªã‚’å®Œå…¨ã«åˆæœŸåŒ–ã—ã¾ã™ã€‚\n\nãƒ»å…¨è¨˜éŒ²\nãƒ»åç°¿ãƒ‡ãƒ¼ã‚¿\nãƒ»ãƒ­ã‚°ã‚¤ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰\n\nã“ã‚Œã‚‰å…¨ã¦ãŒå‰Šé™¤ã•ã‚Œã€åˆæœŸè¨­å®šç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚æœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ", "danger", () => {
                    setIsAuthenticated(false); 
                    localStorage.removeItem('fireguard_keyword');
                    localStorage.removeItem('fireguard_logs');
                    localStorage.removeItem('fireguard_red');
                    localStorage.removeItem('fireguard_grey');
                    localStorage.removeItem('fireguard_victim');
                    localStorage.removeItem('fireguard_perps');
                    setRedScore(0); setGreyScore(0); setLogs([]); setVictimName(''); setPerpetrators(['']);
                    setSavedKeyword(null); setHasSetup(false); setInputKeyword(''); setSetupKeyword('');
                    showToast("åˆæœŸåŒ–ã—ã¾ã—ãŸ");
                });
            };

            const copyReport = () => {
                const header = `ã€ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆè¨˜éŒ²å ±å‘Šæ›¸ã€‘\nä½œæˆæ—¥: ${new Date().toLocaleDateString('ja-JP')}\nè¢«å®³è€…: ${victimName || 'æœªè¨˜å…¥'}\n------------------\n`;
                const body = logs.map(log => 
                    `[${log.date}] ${log.type === 'red' ? 'ğŸ”´ãƒ‘ãƒ¯ãƒãƒ©' : 'âšªã‚°ãƒ¬ãƒ¼'} (Lv.${log.points})\nåŠ å®³è€…: ${log.perpetrator}\nå†…å®¹: ${log.description}\nè¨¼æ‹ : ${log.evidence.hasAudio ? 'éŸ³å£°ã‚ã‚Š ' : ''}${log.evidence.hasPhoto ? 'å†™çœŸã‚ã‚Š ' : ''}${log.evidence.hasWitness ? `ç›®æ’ƒè€…(${log.evidence.witnessName})` : ''}`
                ).join('\n------------------\n');
                
                // Standalone clipboard copy
                const textArea = document.createElement("textarea");
                textArea.value = header + body;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast("ãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
                } catch (err) {
                    showToast("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
                }
                document.body.removeChild(textArea);
            };

            const handleDownloadCSV = () => {
                if (logs.length === 0) return;
                const header = ["æ—¥æ™‚", "ç¨®åˆ¥", "ãƒ¬ãƒ™ãƒ«", "åŠ å®³è€…", "å†…å®¹", "éŸ³å£°è¨¼æ‹ ", "å†™çœŸè¨¼æ‹ ", "ç›®æ’ƒè€…"];
                const rows = logs.map(log => {
                    const escape = (text) => `"${(text || '').replace(/"/g, '""')}"`;
                    return [
                        escape(log.date),
                        log.type === 'red' ? 'RED' : 'GREY',
                        log.points,
                        escape(log.perpetrator),
                        escape(log.description),
                        log.evidence.hasAudio ? 'ã‚ã‚Š' : '',
                        log.evidence.hasPhoto ? 'ã‚ã‚Š' : '',
                        escape(log.evidence.witnessName)
                    ].join(',');
                });
                const csvContent = "\uFEFF" + [header.join(','), ...rows].join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', `FireGuard_Report_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            // Views
            if (!hasSetup) {
                return (
                    <div className="min-h-screen bg-slate-950 text-slate-200 flex items-center justify-center p-4">
                        <Card className="w-full max-w-md p-6 space-y-6">
                            <div className="text-center space-y-2">
                                <Icon name="ShieldAlert" className="w-12 h-12 text-orange-500 mx-auto" />
                                <h1 className="text-2xl font-bold">FireGuard åˆæœŸè¨­å®š</h1>
                                <p className="text-sm text-slate-400">ã‚ãªãŸã®è¨˜éŒ²ã‚’å®ˆã‚‹ãŸã‚ã€<br/>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆåˆè¨€è‘‰ï¼‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>
                            </div>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-300 mb-2">ç§˜å¯†ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
                                    <input type="text" value={setupKeyword} onChange={(e) => setSetupKeyword(e.target.value)} placeholder="ä¾‹: ä»Šæ—¥ã‚‚ä¸€æ—¥ã”å®‰å…¨ã«" className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 focus:border-orange-500 focus:outline-none" />
                                    {setupError && <p className="text-red-400 text-xs mt-1">{setupError}</p>}
                                </div>
                                <div className="bg-slate-900/50 p-3 rounded-lg text-xs text-slate-400 border border-slate-800">
                                    <p>â€»å¿˜ã‚Œãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚<br/>â€»ã‚¢ãƒ—ãƒªã‚’é–‹ããŸã³ã«å¿…è¦ã«ãªã‚Šã¾ã™ã€‚</p>
                                </div>
                                <Button onClick={handleSetup} className="w-full py-3">è¨­å®šã—ã¦é–‹å§‹ã™ã‚‹</Button>
                            </div>
                        </Card>
                        <Modal isOpen={modalConfig.isOpen} title={modalConfig.title} message={modalConfig.message} type={modalConfig.type} onConfirm={modalConfig.onConfirm} onCancel={closeModal} />
                        <Toast show={toastConfig.show} message={toastConfig.message} onClose={() => setToastConfig(prev => ({ ...prev, show: false }))} />
                    </div>
                );
            }

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-slate-950 text-slate-200 flex items-center justify-center p-4">
                        <Card className="w-full max-w-md p-6 space-y-6">
                            <div className="text-center space-y-2">
                                <Icon name="Lock" className="w-10 h-10 text-slate-500 mx-auto" />
                                <h1 className="text-xl font-bold">ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™</h1>
                            </div>
                            <div className="space-y-4">
                                <input id="login-input" type="password" value={inputKeyword} onChange={(e) => setInputKeyword(e.target.value)} placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-center tracking-widest focus:border-orange-500 focus:outline-none transition-all" onKeyDown={(e) => e.key === 'Enter' && handleLogin()} />
                                {setupError && <p className="text-center text-red-400 text-xs animate-pulse">{setupError}</p>}
                                <Button onClick={handleLogin} className="w-full">è§£é™¤</Button>
                            </div>
                        </Card>
                        <Modal isOpen={modalConfig.isOpen} title={modalConfig.title} message={modalConfig.message} type={modalConfig.type} onConfirm={modalConfig.onConfirm} onCancel={closeModal} />
                        <Toast show={toastConfig.show} message={toastConfig.message} onClose={() => setToastConfig(prev => ({ ...prev, show: false }))} />
                    </div>
                );
            }

            const redAdvice = redScore >= 10 ? "ã€å±é™ºæ°´åŸŸã€‘ç›´ã¡ã«ç›¸è«‡çª“å£ã€å¤–éƒ¨ãƒ¦ãƒ‹ã‚ªãƒ³ã¸ã€‚èº«ã®å®‰å…¨ãŒæœ€å„ªå…ˆã§ã™ã€‚" : "ã€è­¦æˆ’ã€‘è¨˜éŒ²ã‚’ç¶šã‘ã¦ãã ã•ã„ã€‚";
            const greyAdvice = greyScore >= 20 ? "ã€é™ç•Œçªç ´ã€‘ã€Œç¾å ´ã®å¸¸è­˜ã€ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚æ³•çš„æªç½®ã‚‚è¦–é‡ã«ã€‚" : "ã€è“„ç©ä¸­ã€‘é•å’Œæ„Ÿã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ã€‚";

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 font-sans pb-24">
                    <header className="bg-slate-900 border-b border-slate-800 sticky top-0 z-50">
                        <div className="max-w-md mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <Icon name="Flame" className="text-orange-500 w-6 h-6" />
                                <h1 className="font-bold text-lg tracking-tight">FireGuard</h1>
                            </div>
                            <div className="flex items-center gap-2">
                                <button onClick={() => setShowTutorial(true)} className="p-2 text-slate-400 hover:text-white"><Icon name="HelpCircle" className="w-5 h-5" /></button>
                                <button onClick={() => setActiveTab(activeTab === 'meter' ? 'settings' : 'meter')} className={`p-2 rounded-full ${activeTab === 'settings' ? 'bg-orange-900 text-orange-200' : 'text-slate-400 hover:text-white'}`}><Icon name="Settings" className="w-5 h-5" /></button>
                                <button onClick={handleLogout} className="text-slate-500 hover:text-slate-300"><Icon name="LogOut" className="w-5 h-5" /></button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-md mx-auto p-4 space-y-6">
                        {activeTab === 'settings' && (
                            <div className="space-y-6 animate-in pb-10">
                                <div className="flex items-center gap-2 text-slate-400 border-b border-slate-800 pb-2">
                                    <Icon name="Settings" className="w-5 h-5" />
                                    <h2 className="font-bold">åç°¿ãƒ»è¨­å®šã‚·ãƒ¼ãƒˆ</h2>
                                </div>
                                <section className="space-y-2">
                                    <h3 className="text-sm font-bold text-orange-400 flex items-center gap-2"><Icon name="User" className="w-4 h-4" /> è¢«å®³è€…ï¼ˆã‚ãªãŸï¼‰</h3>
                                    <Card className="p-4 bg-slate-900">
                                        <Input label="æ°åï¼ˆãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›æ™‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ï¼‰" value={victimName} onChange={(e) => setVictimName(e.target.value)} placeholder="æ¶ˆé˜² å¤ªéƒ" />
                                    </Card>
                                </section>
                                <section className="space-y-2">
                                    <h3 className="text-sm font-bold text-red-400 flex items-center gap-2"><Icon name="UserX" className="w-4 h-4" /> åŠ å®³è€…ãƒªã‚¹ãƒˆ</h3>
                                    <p className="text-xs text-slate-500 mb-2">ã‚ˆãå½“ãŸã‚‹ä¸Šå¸ã‚„å…ˆè¼©ã®åå‰ã‚’ç™»éŒ²ã—ã¦ãŠãã¨ã€è¨˜éŒ²æ™‚ã«é¸æŠã§ãã¦ä¾¿åˆ©ã§ã™ã€‚</p>
                                    <Card className="p-4 bg-slate-900 space-y-3">
                                        {perpetrators.map((perp, index) => (
                                            <div key={index} className="flex gap-2">
                                                <input type="text" value={perp} onChange={(e) => handlePerpetratorChange(index, e.target.value)} placeholder={`åŠ å®³è€…å ${index + 1}`} className="flex-1 bg-slate-950 border border-slate-700 rounded-lg p-2 text-sm focus:border-red-500 focus:outline-none" />
                                                <button onClick={() => handleRemovePerpetrator(index)} className="p-2 text-slate-500 hover:text-red-400">âœ•</button>
                                            </div>
                                        ))}
                                        <Button onClick={handleAddPerpetrator} variant="secondary" className="w-full text-xs py-2">+ åŠ å®³è€…ã‚’è¿½åŠ </Button>
                                    </Card>
                                </section>
                                <section className="space-y-2 pt-4 border-t border-slate-800">
                                    <h3 className="text-sm font-bold text-slate-400 flex items-center gap-2"><Icon name="Trash2" className="w-4 h-4" /> ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ»ãƒªã‚»ãƒƒãƒˆ</h3>
                                    <Card className="p-4 bg-slate-900 space-y-3">
                                        <Button onClick={handleResetData} variant="secondary" className="w-full justify-start text-xs border border-slate-700">
                                            <Icon name="RefreshCw" className="w-4 h-4" /> è¨˜éŒ²ã¨ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ã¿ãƒªã‚»ãƒƒãƒˆ
                                            <span className="text-[10px] text-slate-400 ml-auto font-normal">è¨­å®šã¯ä¿æŒã•ã‚Œã¾ã™</span>
                                        </Button>
                                        <Button onClick={handleFactoryReset} variant="danger" className="w-full justify-start text-xs bg-red-900/50 border border-red-800 hover:bg-red-900">
                                            <Icon name="AlertTriangle" className="w-4 h-4" /> ã‚¢ãƒ—ãƒªå®Œå…¨åˆæœŸåŒ–
                                            <span className="text-[10px] text-red-200 ml-auto font-normal">å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™</span>
                                        </Button>
                                    </Card>
                                </section>
                                <section className="pt-4">
                                    <Button onClick={() => setActiveTab('meter')} variant="primary" className="w-full"><Icon name="Check" className="w-4 h-4" /> è¨­å®šã‚’ä¿å­˜ã—ã¦æˆ»ã‚‹</Button>
                                </section>
                            </div>
                        )}

                        {activeTab === 'meter' && (
                            <>
                                <section className="space-y-4">
                                    <Gauge value={redScore} max={10} color="red" label="ãƒ¬ãƒƒãƒ‰ã‚¾ãƒ¼ãƒ³" icon="Siren" description={redAdvice} />
                                    <Gauge value={greyScore} max={20} color="grey" label="ã‚°ãƒ¬ãƒ¼ã‚¾ãƒ¼ãƒ³" icon="Activity" description={greyAdvice} />
                                </section>
                                {!showInput ? (
                                    <Button onClick={() => setShowInput(true)} className="w-full py-4 text-lg shadow-orange-900/20"><Icon name="FileText" className="w-5 h-5" /> äº‹æ¡ˆã‚’è¨˜éŒ²ã™ã‚‹</Button>
                                ) : (
                                    <Card className="animate-in slide-in-from-bottom-5 duration-300">
                                        <div className="bg-slate-900 p-3 border-b border-slate-700 flex justify-between items-center">
                                            <h3 className="font-bold text-slate-300">æ–°è¦è¨˜éŒ²</h3>
                                            <button onClick={() => setShowInput(false)} className="text-slate-400 hover:text-white"><Icon name="X" className="w-5 h-5" /></button>
                                        </div>
                                        <div className="p-4 space-y-4">
                                            <div className="grid grid-cols-2 gap-2">
                                                <button onClick={() => setIncidentType('grey')} className={`p-3 rounded-lg border flex flex-col items-center gap-1 transition-all ${incidentType === 'grey' ? 'bg-slate-700 border-slate-400 text-white' : 'border-slate-800 text-slate-500'}`}><Icon name="Activity" className="w-5 h-5" /><span className="text-xs font-bold">ã‚°ãƒ¬ãƒ¼</span></button>
                                                <button onClick={() => setIncidentType('red')} className={`p-3 rounded-lg border flex flex-col items-center gap-1 transition-all ${incidentType === 'red' ? 'bg-red-900/50 border-red-500 text-red-200' : 'border-slate-800 text-slate-500'}`}><Icon name="Siren" className="w-5 h-5" /><span className="text-xs font-bold">ãƒ¬ãƒƒãƒ‰</span></button>
                                            </div>
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 block">åŠ å®³è€… (è¨­å®šã‚·ãƒ¼ãƒˆã§ç·¨é›†å¯)</label>
                                                <select value={selectedPerpetrator} onChange={(e) => setSelectedPerpetrator(e.target.value)} className="w-full bg-slate-950 border border-slate-700 rounded-lg p-2 text-sm text-slate-200 focus:border-orange-500 outline-none">
                                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                                    {perpetrators.map((p, i) => p && <option key={i} value={p}>{p}</option>)}
                                                    <option value="ãã®ä»–">ãã®ä»–</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 block">ãƒ€ãƒ¡ãƒ¼ã‚¸ (1-{incidentType === 'red' ? '5' : '3'})</label>
                                                <input type="range" min="1" max={incidentType === 'red' ? 5 : 3} value={intensity} onChange={(e) => setIntensity(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-orange-500" />
                                            </div>
                                            <textarea className="w-full bg-slate-950 border border-slate-700 rounded-lg p-3 text-sm focus:outline-none focus:border-orange-500 transition-colors" rows="3" placeholder="å†…å®¹ã‚’å…¥åŠ›..." value={description} onChange={(e) => setDescription(e.target.value)} />
                                            <div className="grid grid-cols-3 gap-2">
                                                <button onClick={() => setHasAudio(!hasAudio)} className={`flex flex-col items-center justify-center p-2 rounded border transition-all ${hasAudio ? 'bg-green-900/30 border-green-500 text-green-400' : 'border-slate-700 text-slate-600'}`}><Icon name="Mic" className="w-4 h-4 mb-1" /><span className="text-[10px]">éŸ³å£°</span></button>
                                                <button onClick={() => setHasPhoto(!hasPhoto)} className={`flex flex-col items-center justify-center p-2 rounded border transition-all ${hasPhoto ? 'bg-green-900/30 border-green-500 text-green-400' : 'border-slate-700 text-slate-600'}`}><Icon name="Camera" className="w-4 h-4 mb-1" /><span className="text-[10px]">å†™çœŸ</span></button>
                                                <button onClick={() => setHasWitness(!hasWitness)} className={`flex flex-col items-center justify-center p-2 rounded border transition-all ${hasWitness ? 'bg-green-900/30 border-green-500 text-green-400' : 'border-slate-700 text-slate-600'}`}><Icon name="Users" className="w-4 h-4 mb-1" /><span className="text-[10px]">ç›®æ’ƒè€…</span></button>
                                            </div>
                                            {hasWitness && <input type="text" placeholder="ç›®æ’ƒè€…å" value={witnessNameInput} onChange={(e) => setWitnessNameInput(e.target.value)} className="w-full bg-slate-950 border border-slate-700 rounded p-2 text-xs" />}
                                            <Button onClick={handleSubmitLog} className="w-full" disabled={!description}><Icon name="Save" className="w-4 h-4" /> è¨˜éŒ²ã«è¿½åŠ </Button>
                                        </div>
                                    </Card>
                                )}
                                <section>
                                    <div className="flex justify-between items-center mb-3 px-1">
                                        <h3 className="font-bold text-slate-400 text-sm uppercase tracking-wider">å±¥æ­´ãƒ­ã‚°</h3>
                                        <div className="flex gap-2">
                                            <button onClick={handleResetData} className="text-xs text-slate-600 hover:text-red-400 flex items-center gap-1"><Icon name="Trash2" className="w-3 h-3" /> å‰Šé™¤</button>
                                            {logs.length > 0 && (
                                                <>
                                                    <button onClick={handleDownloadCSV} className="text-xs text-blue-400 flex items-center gap-1 hover:text-blue-300 ml-2"><Icon name="Download" className="w-3 h-3" /> CSVå‡ºåŠ›</button>
                                                    <button onClick={copyReport} className="text-xs text-orange-400 flex items-center gap-1 hover:text-orange-300 ml-2"><Icon name="FileText" className="w-3 h-3" /> å…¨ã¦ã‚³ãƒ”ãƒ¼</button>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                    <div className="space-y-3 pb-8">
                                        {logs.length === 0 ? (
                                            <div className="text-center py-8 text-slate-600 border-2 border-dashed border-slate-800 rounded-lg"><Icon name="ShieldAlert" className="w-8 h-8 mx-auto mb-2 opacity-50" /><p className="text-sm">è¨˜éŒ²ãªã—</p></div>
                                        ) : (
                                            logs.map(log => (
                                                <Card key={log.id} className="relative">
                                                    <div className={`absolute left-0 top-0 bottom-0 w-1 ${log.type === 'red' ? 'bg-red-600' : 'bg-slate-400'}`}></div>
                                                    <div className="p-3 pl-4">
                                                        <div className="flex justify-between items-start mb-1">
                                                            <div className="flex items-center gap-2">
                                                                <span className={`text-xs font-bold px-2 py-0.5 rounded ${log.type === 'red' ? 'bg-red-900 text-red-200' : 'bg-slate-700 text-slate-300'}`}>{log.type === 'red' ? 'RED' : 'GREY'}</span>
                                                                <span className="text-xs text-slate-500">{log.date}</span>
                                                            </div>
                                                            <span className="text-xs font-bold text-orange-500">Lv.{log.points}</span>
                                                        </div>
                                                        <div className="flex items-center gap-1 mb-2 text-xs text-slate-400 bg-slate-900/50 p-1 rounded w-fit">
                                                            <Icon name="UserX" className="w-3 h-3" /> <span className="font-bold">{log.perpetrator}</span>
                                                        </div>
                                                        <p className="text-sm text-slate-300 mb-2 whitespace-pre-wrap">{log.description}</p>
                                                        <div className="flex gap-2">
                                                            {log.evidence.hasAudio && <span className="text-[10px] bg-slate-800 border border-slate-700 px-1.5 py-0.5 rounded text-slate-400 flex items-center gap-1"><Icon name="Mic" className="w-3 h-3" />éŸ³å£°</span>}
                                                            {log.evidence.hasPhoto && <span className="text-[10px] bg-slate-800 border border-slate-700 px-1.5 py-0.5 rounded text-slate-400 flex items-center gap-1"><Icon name="Camera" className="w-3 h-3" />å†™çœŸ</span>}
                                                            {log.evidence.hasWitness && <span className="text-[10px] bg-slate-800 border border-slate-700 px-1.5 py-0.5 rounded text-slate-400 flex items-center gap-1"><Icon name="Users" className="w-3 h-3" />{log.evidence.witnessName}</span>}
                                                        </div>
                                                    </div>
                                                </Card>
                                            ))
                                        )}
                                    </div>
                                </section>
                            </>
                        )}

                        <Modal isOpen={showTutorial} title="FireGuardã®ä½¿ã„æ–¹" showCancel={false} confirmText="é–‰ã˜ã‚‹" onConfirm={() => setShowTutorial(false)} onCancel={() => setShowTutorial(false)}>
                            <div className="space-y-4">
                                <TutorialAnimation />
                                <div className="text-xs text-slate-400 space-y-2">
                                    <p><strong>1. ä¿è­· (Protection)</strong><br/>æœ€åˆã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã€ã‚ãªãŸã ã‘ã®ç§˜å¯†ã®è¨˜éŒ²ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ã—ã¾ã™ã€‚</p>
                                    <p><strong>2. è¨˜éŒ² (Record)</strong><br/>ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆã®ç¨®åˆ¥ï¼ˆãƒ¬ãƒƒãƒ‰/ã‚°ãƒ¬ãƒ¼ï¼‰ã‚’é¸ã³ã€è©³ç´°ã‚’è¨˜éŒ²ã€‚ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒè“„ç©ã•ã‚Œã¾ã™ã€‚</p>
                                    <p><strong>3. è§£æ±º (Action)</strong><br/>é™ç•Œå€¤ã‚’è¶…ãˆãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚è¨˜éŒ²ã‚’ã‚³ãƒ”ãƒ¼ã¾ãŸã¯CSVå‡ºåŠ›ã—ã¦è¨¼æ‹ ã¨ã—ã¦æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚</p>
                                </div>
                            </div>
                        </Modal>

                        <Modal isOpen={modalConfig.isOpen} title={modalConfig.title} message={modalConfig.message} type={modalConfig.type} showCancel={modalConfig.showCancel} confirmText={modalConfig.confirmText} onConfirm={modalConfig.onConfirm} onCancel={closeModal} />
                        <Toast show={toastConfig.show} message={toastConfig.message} onClose={() => setToastConfig(prev => ({ ...prev, show: false }))} />

                        {(redScore >= 10 || greyScore >= 20) && (
                            <div className="fixed bottom-0 left-0 right-0 bg-red-900/90 backdrop-blur-sm border-t border-red-500 p-4 z-50 animate-pulse">
                                <div className="max-w-md mx-auto flex items-center gap-4">
                                    <Icon name="AlertTriangle" className="w-10 h-10 text-red-100 flex-shrink-0" />
                                    <div>
                                        <h4 className="font-bold text-white">é™ç•Œå€¤ã‚’è¶…ãˆã¦ã„ã¾ã™</h4>
                                        <p className="text-xs text-red-100">ä¸€äººã§æŠ±ãˆè¾¼ã¾ãšã€å¤–éƒ¨æ©Ÿé–¢ã‚„ä¿¡é ¼ã§ãã‚‹ä¸Šå¸ã¸ç›¸è«‡ã—ã¦ãã ã•ã„ã€‚</p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
                );
            }

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        </script>
</body>
</html>
