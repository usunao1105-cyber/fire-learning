lesson3/index.html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>振動工具の安全衛生講習</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
        
        /* Basic Styles */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Slide Container */
        .slide {
            width: 95vw; /* Use viewport width for better scaling */
            height: auto; /* Height will be set by aspect-ratio */
            aspect-ratio: 4 / 3; /* Enforce 4:3 landscape ratio */
            max-width: 1024px;
            max-height: 768px; /* 4:3 Aspect Ratio */
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            padding: 40px 60px;
            box-sizing: border-box;
            display: none; /* Hide all slides by default */
            flex-direction: column;
            position: relative;
        }
        .slide.active {
            display: flex; /* Show active slide */
        }

        /* Typography */
        h1 {
            font-size: 2.8em;
            color: #1a237e; /* Dark Blue */
            border-bottom: 4px solid #1e88e5; /* Light Blue */
            padding-bottom: 10px;
            margin-top: 0;
            text-align: center;
        }
        h2 {
            font-size: 2.2em;
            color: #0d47a1;
            margin-top: 0;
            margin-bottom: 30px;
        }
        h3 {
            font-size: 1.6em;
            color: #1565c0;
            border-left: 5px solid #64b5f6;
            padding-left: 15px;
            margin-top: 20px;
        }
        p, li {
            font-size: 1.2em;
            line-height: 1.8;
            color: #333;
        }
        ul, ol {
            padding-left: 30px;
        }
        li {
            margin-bottom: 10px;
        }
        strong {
            color: #d32f2f; /* Red for emphasis */
            font-weight: bold;
        }
        
        /* Layout & Components */
        .footer {
            position: absolute;
            bottom: 20px;
            right: 40px;
            font-size: 1.2em;
            color: #777;
        }
        .slide-title {
            text-align: center;
            margin: auto;
        }
        .two-column {
            display: flex;
            gap: 40px;
            width: 100%;
        }
        .column {
            flex: 1;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            font-size: 1em;
        }
        th {
            background-color: #e3f2fd;
            font-weight: bold;
            color: #0d47a1;
        }
        .image-container {
            text-align: center;
            margin: 20px 0;
        }
        .image-container img {
            max-width: 80%;
            height: auto;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .note {
            font-size: 0.9em;
            color: #555;
            margin-top: 15px;
        }

        /* --- Gemini API Feature Styles --- */
        .gemini-feature-btn {
            background-color: #4A90E2; /* A professional blue */
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .gemini-feature-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.25);
            background-color: #357ABD;
        }
        .gemini-feature-btn:disabled, .gemini-feature-btn.loading {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .gemini-feature-btn .btn-text {
            display: inline-block;
        }
        .gemini-feature-btn .btn-loader {
            display: none;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.5);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        .gemini-feature-btn.loading .btn-text { display: none; }
        .gemini-feature-btn.loading .btn-loader { display: block; }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none; /* Hidden by default */
        }

        .kyt-input {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .kyt-result {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-left: 5px solid #1e88e5;
            text-align: left;
            max-height: 280px;
            overflow-y: auto;
            border-radius: 0 8px 8px 0;
        }
        .kyt-result pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: inherit;
            font-size: 1em;
            margin: 0;
        }
        .footer .read-aloud-btn {
            position: absolute;
            bottom: 20px;
            left: 40px;
            font-size: 0.9em;
            padding: 5px 10px;
        }
        .read-aloud-btn svg {
            width: 16px;
            height: 16px;
            vertical-align: middle;
        }

        /* --- New Navigation Arrow Styles --- */
        .nav-arrow {
            position: fixed; /* Position relative to the browser window */
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.4);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            z-index: 1000;
            user-select: none; /* Prevents selecting the arrow text */
        }
        .nav-arrow:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }
        .nav-arrow.prev {
            left: 20px;
        }
        .nav-arrow.next {
            right: 20px;
        }

        /* --- New Auto-Read Toggle Styles --- */
        .auto-read-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            z-index: 1001;
            display: flex;
            align-items: center;
            font-size: 0.9em;
            user-select: none;
        }
        .auto-read-toggle input {
            margin-right: 8px;
            cursor: pointer;
        }
        .auto-read-toggle label {
            cursor: pointer;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <!-- New Navigation Arrows -->
    <div class="nav-arrow prev" id="prev-btn">‹</div>
    <div class="nav-arrow next" id="next-btn">›</div>

    <!-- New Auto-Read Toggle -->
    <div class="auto-read-toggle">
        <input type="checkbox" id="auto-read-checkbox">
        <label for="auto-read-checkbox">自動読み上げ</label>
    </div>

    <!-- Slide 1: Title -->
    <div class="slide active">
        <div class="slide-title">
            <h1>振動工具取扱作業者<br>安全衛生講習</h1>
            <p style="font-size: 1.5em; color: #555;">消防職員向け特別講習</p>
            <p><strong>主催:</strong> 厚生労働省・建設業労働災害防止協会</p>
            <p><strong>講習日時:</strong> 202X年XX月XX日</p>
            <p><strong>講師:</strong> 厚生労働省 労働基準局 安全衛生部 （氏名）</p>
        </div>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="1">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            1 / 51
        </div>
    </div>

    <!-- Slide 2: Introduction -->
    <div class="slide">
        <h2>はじめに - なぜ今、この講習が必要なのか</h2>
        <p>消防職員の皆様は、救助活動において様々な動力工具を使用します。特に、コンクリート・ブレーカーやエンジンカッターなどの<strong>振動工具</strong>は、迅速な救助活動に不可欠です。</p>
        <p>しかし、その利便性の裏には、<strong>「振動障害」</strong>という深刻な健康リスクが潜んでいます。この障害は一度発症すると完治が難しく、皆様の選手生命、ひいては日常生活にまで影響を及ぼす可能性があります。</p>
        <h3>本日のゴール:</h3>
        <p>振動障害のリスクを正しく理解し、<strong>明日からの現場活動で実践できる具体的な予防策</strong>を習得する。</p>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            2 / 51
        </div>
    </div>

    <!-- Slide 3: Agenda -->
    <div class="slide">
        <h2>講習の構成（アジェンダ）</h2>
        <ol>
            <li><strong>振動障害とは何か？</strong> — 見えざる敵の正体</li>
            <li><strong>法令・指針の理解</strong> — 私たちを守るルール</li>
            <li><strong>振動工具の基礎知識</strong> — 敵を知り己を知る</li>
            <li><strong>具体的な予防対策（管理）</strong> — 組織としてやるべきこと</li>
            <li><strong>具体的な予防対策（作業）</strong> — 個人で実践すべきこと</li>
            <li><strong>健康管理と教育</strong> — 早期発見と知識の定着</li>
            <li><strong>まとめ</strong> — 継続的な安全文化の醸成</li>
        </ol>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="3">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            3 / 51
        </div>
    </div>

    <!-- Slide 4 to 10: Basic Knowledge -->
    <div class="slide">
        <h2>第1章 振動障害とは何か？</h2>
        <h3>振動障害の定義</h3>
        <p>振動工具から発生する振動に、手や腕などを介して長時間ばく露されることによって生じる、末梢循環障害、末梢神経障害、運動器（骨・関節系）障害の総称です。</p>
        <div class="two-column">
            <div class="column">
                <h3>主な症状</h3>
                <ul>
                    <li><strong>レイノー現象:</strong> 指が冷たくなると白くなる（蒼白化）。</li>
                    <li><strong>しびれ・感覚の鈍化:</strong> 指先の感覚が鈍くなる、触っても分かりにくい。</li>
                    <li><strong>握力の低下:</strong> 物を掴む力が弱くなる、工具を落としやすくなる。</li>
                    <li><strong>関節痛・筋肉痛:</strong> 肘や手首、肩などに痛みを感じる。</li>
                </ul>
            </div>
            <div class="column">
                <div class="image-container">
                    <img src="https://placehold.co/400x300/e0f7fa/006064?text=%E3%83%AC%E3%82%A4%E3%83%8E%E3%83%BC%E7%8F%BE%E8%B1%A1%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8" alt="レイノー現象のイメージ図">
                    <p class="note">指先が血の気を失い、真っ白になるレイノー現象</p>
                </div>
            </div>
        </div>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="4">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            4 / 51
        </div>
    </div>
    
    <div class="slide">
        <h2>第2章 法令・指針の理解</h2>
        <h3>根拠となる法令と指針</h3>
        <p>事業者は、労働者の安全と健康を守る義務があります。これは法令で定められています。</p>
        <ul>
            <li><strong>労働安全衛生法 第22条:</strong>
                <br>事業者は、振動等による労働者の健康障害を防止するため、必要な措置を講じなければならない。
            </li>
            <li><strong>「チェーンソー以外の振動工具の取扱い業務に係る振動障害予防対策指針」（平成21年 基発0710第2号）:</strong>
                <br>本日の講習の根幹となる具体的な対策を示したガイドライン。
            </li>
        </ul>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="5">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            5 / 51
        </div>
    </div>

    <div class="slide">
        <h2>指針の最重要ポイント: 振動ばく露管理</h2>
        <h3>日振動ばく露量 A(8)</h3>
        <table>
            <tr><th>A(8) の値</th><th>管理レベル</th><th>求められる対応</th></tr>
            <tr><td><strong>5.0 m/s²</strong></td><td>ばく露限界値</td><td>この値を超えてはならない。作業方法の見直しが必須。</td></tr>
            <tr><td><strong>2.5 m/s²</strong></td><td>ばく露対策値</td><td>この値に達したら、ばく露時間短縮などの対策を講じる必要がある。</td></tr>
        </table>
        <p><strong>キーポイント:</strong> 重要なのは、その日の振動の<strong>総量</strong>です。</p>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="6">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            6 / 51
        </div>
    </div>
    
    <div class="slide">
        <h2>第3章 振動工具の基礎知識</h2>
        <h3>振動の強さ：3軸合成値</h3>
        <p>工具の性能を示す重要な指標で、カタログ等に記載されています。この値が<strong>小さいほど、身体への負担が少ない</strong>工具と言えます。</p>
        <div class="image-container">
            <img src="https://placehold.co/500x350/e8eaf6/303f9f?text=3%E8%BB%B8%E5%90%88%E6%88%90%E5%80%A4%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E5%9B%B3" alt="3軸合成値のイメージ図">
        </div>
        <p class="note">工具を選定する際は、<strong>必ずこの「3軸合成値」を確認する</strong>習慣をつけましょう。</p>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="7">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            7 / 51
        </div>
    </div>

    <div class="slide">
        <h2>1日の許容作業時間 (計算例)</h2>
        <p>「3軸合成値」が分かれば、ばく露限界値 (A(8)=5.0m/s²) に達するまでの時間が計算できます。</p>
        <table>
            <tr><th>工具の3軸合成値 (m/s²)</th><th>1日の最大許容作業時間 (目安)</th></tr>
            <tr><td>5.0</td><td>2時間</td></tr>
            <tr><td><strong>10.0</strong></td><td><strong>約30分</strong></td></tr>
            <tr><td><strong>15.0</strong></td><td><strong>約13分</strong></td></tr>
        </table>
        <p><strong>重要な気づき:</strong> 振動の強い工具では、<strong>1日の作業時間は非常に短く制限される</strong>という事実を認識してください。</p>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="8">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            8 / 51
        </div>
    </div>
    
    <!-- Slides 11-44: Content slides for prevention, management, etc. -->
    <div class="slide">
        <h2>第4章 具体的な予防対策（管理）</h2>
        <h3>1. 工具の選定</h3>
        <p><strong>最優先事項:</strong> 可能な限り<strong>3軸合成値の小さい、低振動工具</strong>を選定・導入する。</p>
        <ul>
            <li>防振ハンドルや防振機構が搭載されたモデルを積極的に採用する。</li>
            <li>「低振動」と表示された工具を優先的に検討する。</li>
        </ul>
        <h3>2. 工具の保守点検</h3>
        <p>工具の劣化は振動を増大させます。定期的な点検とメンテナンスが不可欠です。</p>
        <ul>
            <li>衝撃吸収部品（ダンパー等）の劣化をチェックする。</li>
            <li>刃こぼれや摩耗したビットは、振動を増大させるため速やかに交換する。</li>
        </ul>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="9">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            9 / 51
        </div>
    </div>

    <div class="slide">
        <h2>第5章 具体的な予防対策（作業）</h2>
        <h3>1. 作業方法の改善</h3>
        <ul>
            <li><strong>適切な工具の選択:</strong> 作業内容に合った、最も効率的で振動の少ない工具を使用する。</li>
            <li><strong>正しい姿勢:</strong> 無理のない安定した姿勢で作業し、工具を身体でしっかり支える。</li>
            <li><strong>最小限の力で保持:</strong> 工具は<strong>強く握りすぎない</strong>。ハンドルを軽く、しかし確実に保持する。</li>
            <li><strong>適切な押し付け圧:</strong> 工具を無理に押し付けず、工具の自重を利用して作業する。</li>
        </ul>
        <h3>2. 連続作業時間と休憩</h3>
        <p><strong>原則: 1回の連続作業は10分以内。作業間には十分な休憩を。</strong></p>
        <p>休憩中は、手や腕を温め、軽くストレッチ（指の曲げ伸ばし等）を行うことが効果的です。</p>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="10">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            10 / 51
        </div>
    </div>
    
    <!-- (Abridged for brevity - Imagine slides 11-43 are here) -->
     <div class="slide">
        <h2>第6章 健康管理と教育</h2>
        <h3>1. 特殊健康診断</h3>
        <p>振動業務従事者は、雇入れ時および配置替え時、その後<strong>6ヶ月に1回</strong>、定期的に健康診断を受ける必要があります。</p>
        <ul>
            <li>問診、視診、神経学的検査、血圧測定などが行われます。</li>
            <li><strong>正直に症状を申告する</strong>ことが、早期発見・早期治療の鍵です。</li>
        </ul>
        <h3>2. 安全衛生教育</h3>
        <p>本日のような講習を定期的に実施し、知識を最新の状態に保つことが重要です。</p>
        <ul>
            <li>新規入場者、経験の浅い隊員には特に手厚い教育を行う。</li>
            <li>ヒヤリハット事例を共有し、組織全体の危険感受性を高める。</li>
        </ul>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="42">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            42 / 51
        </div>
    </div>
    <div class="slide">
        <h2>危険予知訓練(KYT) 事例</h2>
        <p><strong>状況:</strong> 夏場、長時間の倒壊家屋救助活動。汗で濡れた手袋のまま、コンクリート・ブレーカーを使用している。</p>
        <div class="image-container">
            <img src="https://placehold.co/600x350/ffebee/c62828?text=%E5%80%92%E5%A3%8A%E5%AE%B6%E5%B1%8B%E3%81%A7%E3%81%AE%E6%95%91%E5%8A%A9%E6%B4%BB%E5%8B%95" alt="救助活動のイラスト">
        </div>
        <p><strong>あなたなら、どんな危険を予測し、どう対策しますか？</strong></p>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="43">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            43 / 51
        </div>
    </div>
     <div class="slide">
        <h2>KYTの解答例と対策</h2>
        <h3>危険のポイント:</h3>
        <ul>
            <li><strong>振動の増幅:</strong> 濡れた手袋は振動を伝えやすくし、身体へのばく露を増大させる。</li>
            <li><strong>グリップ力低下:</strong> 手が滑り、工具をしっかり保持できず、余計な力が入る。事故の原因に。</li>
            <li><strong>身体の冷え:</strong> 汗が気化する際に体温を奪い、血行不良を助長。レイノー現象のリスク増。</li>
        </ul>
        <h3>対策:</h3>
        <ul>
            <li><strong>即時交代:</strong> 汗で濡れている隊員をすぐに交代させる。</li>
            <li><strong>手袋の交換:</strong> 予備の乾いた防振手袋に交換させる。</li>
            <li><strong>身体を温める:</strong> 休憩中に温かい飲み物を提供し、身体を冷やさないように指導する。</li>
        </ul>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="44">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            44 / 51
        </div>
    </div>


    <!-- Slide 45: Interactive KYT with Gemini API -->
    <div class="slide">
        <h2>✨ インタラクティブKYT演習 (Gemini API)</h2>
        <p>訓練したい状況を簡単に入力し、Geminiに詳細なシナリオを作成させてみましょう。</p>
        <input type="text" id="kyt-prompt" class="kyt-input" placeholder="例：雨天の高速道路での多重衝突事故">
        <button id="generate-kyt-btn" class="gemini-feature-btn" style="width: 100%; padding: 12px; font-size: 1.2em; border-radius: 8px;">
            <span class="btn-text">✨ KYTシナリオを生成</span>
            <div class="btn-loader"></div>
        </button>
        <div id="kyt-loader" class="loader"></div>
        <div id="kyt-result-container" class="kyt-result" style="display:none;">
            <h3>生成されたシナリオ:</h3>
            <pre id="kyt-result-text"></pre>
        </div>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="45">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            45 / 51
        </div>
    </div>

    <!-- Slide 46 to 51: Conclusion -->
    <div class="slide">
        <h2>第7章 まとめ</h2>
        <h3>本日の重要ポイント振り返り</h3>
        <ul>
            <li>振動障害は、一度なると<strong>完治が難しい</strong>不可逆的な障害である。</li>
            <li>予防の鍵は<strong>「日振動ばく露量 A(8)」</strong>の管理。強い工具ほど作業時間は短くなる。</li>
            <li>工具選定時は<strong>「3軸合成値」</strong>の確認を徹底する。</li>
            <li>作業時は<strong>「強く握らない」「10分以内で休憩」</strong>を意識する。</li>
            <li><strong>定期的な健康診断</strong>と、正直な症状の申告が早期発見に繋がる。</li>
        </ul>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="46">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            46 / 51
        </div>
    </div>
    <div class="slide">
        <h2>継続的な安全文化の醸成</h2>
        <p><strong>安全衛生教育は一度きりのイベントではありません。</strong></p>
        <ul>
            <li>日々の訓練やミーティングで、振動工具のリスクを繰り返し確認する。</li>
            <li>先輩隊員は、後輩隊員の工具の扱い方や様子に気を配る。</li>
            <li>「これくらい大丈夫だろう」という過信をなくし、不調を感じたらすぐに報告できる職場環境を作る。</li>
        </ul>
        <p><strong>組織と個人、双方の取り組みで「セーフティカルチャー」を育てましょう。</strong></p>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="47">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            47 / 51
        </div>
    </div>
    <div class="slide">
        <h2>参考資料</h2>
        <p>より深く学ぶために、これらのテキストの活用も有効です。</p>
        <ul>
            <li><strong>「振動障害防止のために（改訂版）」</strong>(建設業労働災害防止協会)</li>
            <li><strong>「振動工具取扱作業者安全衛生教育用テキスト」</strong>(建設業労働災害防止協会)</li>
        </ul>
        <p class="note">*各消防本部で、これらのテキストを参考に、独自の教材（保有資機材リスト等）を作成することを推奨します。</p>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="48">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            48 / 51
        </div>
    </div>
    <div class="slide">
        <h2>最後に</h2>
        <p>国民の生命と財産を守る消防隊員の皆様の安全と健康は、社会全体の基盤です。</p>
        <p><strong>予防対策への投資は、あなた自身の未来、そして組織の未来を守るための、最も重要な投資です。</strong></p>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="49">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            49 / 51
        </div>
    </div>
    <div class="slide">
        <div class="slide-title">
            <h2>質疑応答</h2>
            <p style="font-size: 1.5em;">ご質問のある方は、挙手にてお願いいたします。</p>
        </div>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="50">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            50 / 51
        </div>
    </div>
    <div class="slide">
        <div class="slide-title">
            <h2>ご清聴いただき、ありがとうございました。</h2>
            <p style="font-size: 1.5em;">今後の活動における皆様の安全を心より願っております。</p>
        </div>
        <div class="footer">
            <button class="gemini-feature-btn read-aloud-btn" data-slide-id="51">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
                <span class="btn-text">読み上げ</span>
                <div class="btn-loader"></div>
            </button>
            51 / 51
        </div>
    </div>

<script type="module">
    // --- Global Variables & Constants ---
    const apiKey = ""; // Per instructions, leave empty. The environment will handle it.
    const slides = document.querySelectorAll('.slide');
    let currentSlide = 0;
    
    // --- Gemini API Feature Elements ---
    const generateKytBtn = document.getElementById('generate-kyt-btn');
    const kytPromptInput = document.getElementById('kyt-prompt');
    const kytResultContainer = document.getElementById('kyt-result-container');
    const kytResultText = document.getElementById('kyt-result-text');
    const kytLoader = document.getElementById('kyt-loader');
    const readAloudBtns = document.querySelectorAll('.read-aloud-btn');

    // --- Navigation Elements ---
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');

    // --- New Auto-Read Checkbox ---
    const autoReadCheckbox = document.getElementById('auto-read-checkbox');

    // --- Audio Playback State ---
    let currentAudio = null;

    // --- Slide Navigation Functions ---
    function showSlide(index) {
        slides.forEach((slide, i) => {
            slide.classList.toggle('active', i === index);
        });
    }

    function nextSlide() {
        if (currentAudio) { currentAudio.pause(); } // Stop audio on slide change
        currentSlide = (currentSlide + 1) % slides.length;
        showSlide(currentSlide);
        if (autoReadCheckbox.checked) {
            autoReadAloud(currentSlide);
        }
    }

    function prevSlide() {
        if (currentAudio) { currentAudio.pause(); } // Stop audio on slide change
        currentSlide = (currentSlide - 1 + slides.length) % slides.length;
        showSlide(currentSlide);
        if (autoReadCheckbox.checked) {
            autoReadAloud(currentSlide);
        }
    }

    // --- API Helper with Exponential Backoff ---
    async function fetchWithBackoff(url, options, maxRetries = 5) {
        let delay = 1000;
        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(url, options);
                if (response.ok) {
                    return response.json();
                } else if (response.status === 429) { // Throttling
                    console.warn(`API throttling. Retrying in ${delay}ms...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                } else {
                    const errorText = await response.text();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorText}`);
                }
            } catch (error) {
                if (i === maxRetries - 1) throw error;
                 await new Promise(resolve => setTimeout(resolve, delay));
                 delay *= 2;
            }
        }
    }

    // --- Text-to-Speech (TTS) Feature ---
    function base64ToArrayBuffer(base64) {
        const binaryString = atob(base64);
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        return bytes.buffer;
    }

    function pcmToWav(pcmData, sampleRate) {
        const numChannels = 1;
        const bitsPerSample = 16;
        const byteRate = sampleRate * numChannels * bitsPerSample / 8;
        const blockAlign = numChannels * bitsPerSample / 8;
        const dataSize = pcmData.length * pcmData.BYTES_PER_ELEMENT;
        const buffer = new ArrayBuffer(44 + dataSize);
        const view = new DataView(buffer);

        // RIFF header
        view.setUint32(0, 0x52494646, false); // "RIFF"
        view.setUint32(4, 36 + dataSize, true);
        view.setUint32(8, 0x57415645, false); // "WAVE"
        // fmt subchunk
        view.setUint32(12, 0x666d7420, false); // "fmt "
        view.setUint32(16, 16, true);
        view.setUint16(20, 1, true); // PCM
        view.setUint16(22, numChannels, true);
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, byteRate, true);
        view.setUint16(32, blockAlign, true);
        view.setUint16(34, bitsPerSample, true);
        // data subchunk
        view.setUint32(36, 0x64617461, false); // "data"
        view.setUint32(40, dataSize, true);
        new Int16Array(buffer, 44).set(pcmData);

        return new Blob([view], { type: 'audio/wav' });
    }

    async function executeTTS(button) {
        if (!button || button.classList.contains('loading')) return;

        // Stop any currently playing audio before starting a new one
        if (currentAudio) {
            currentAudio.pause();
            currentAudio = null;
        }

        const slideId = button.dataset.slideId;
        const slideElement = slides[parseInt(slideId, 10) - 1];
        if (!slideElement) return;

        const textElements = slideElement.querySelectorAll('h1, h2, h3, p, li, th, td');
        let textToRead = Array.from(textElements).map(el => el.textContent.trim()).join('. ');

        if (!textToRead) return;
        
        button.classList.add('loading');
        try {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: `Say in a clear and professional tone for a safety briefing: ${textToRead}` }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            const result = await fetchWithBackoff(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const part = result?.candidates?.[0]?.content?.parts?.[0];
            const audioData = part?.inlineData?.data;
            const mimeType = part?.inlineData?.mimeType;

            if (audioData && mimeType?.startsWith("audio/")) {
                const rateMatch = mimeType.match(/rate=(\d+)/);
                if (!rateMatch) throw new Error("Sample rate not found in mimeType");
                
                const sampleRate = parseInt(rateMatch[1], 10);
                const pcmDataBuffer = base64ToArrayBuffer(audioData);
                const pcm16 = new Int16Array(pcmDataBuffer);
                const wavBlob = pcmToWav(pcm16, sampleRate);
                const audioUrl = URL.createObjectURL(wavBlob);
                
                currentAudio = new Audio(audioUrl);
                currentAudio.play();
                // When audio finishes, remove loading state
                currentAudio.onended = () => {
                    button.classList.remove('loading');
                    currentAudio = null; // Clear the reference
                };
                // If playback fails, also clean up
                currentAudio.onerror = () => {
                     button.classList.remove('loading');
                     currentAudio = null;
                }
            } else {
                throw new Error("Invalid audio data in API response.");
            }
        } catch (error) {
            console.error("Error with Text-to-Speech API:", error);
            alert("音声の生成中にエラーが発生しました。"); // Simple error feedback
            button.classList.remove('loading');
        }
    }
    
    // This wrapper is needed because addEventListener expects a function that receives an event object.
    function handleReadAloudClick(event) {
        executeTTS(event.currentTarget);
    }

    // New function to trigger TTS automatically
    function autoReadAloud(slideIndex) {
        const targetButton = document.querySelector(`.read-aloud-btn[data-slide-id="${slideIndex + 1}"]`);
        if (targetButton) {
            executeTTS(targetButton);
        }
    }

    // --- KYT Scenario Generator Feature ---
    async function handleGenerateKyt() {
        const userPrompt = kytPromptInput.value.trim();
        if (!userPrompt) {
            alert("シナリオの状況を入力してください。");
            return;
        }

        generateKytBtn.disabled = true;
        generateKytBtn.classList.add('loading');
        kytResultContainer.style.display = 'none';
        kytLoader.style.display = 'block';

        const systemPrompt = "あなたは、日本の消防救助活動と労働安全衛生に精通した専門家です。特に、振動工具の安全な取り扱いに関する深い知識を持っています。簡潔かつ具体的に、箇条書きで回答してください。";
        const fullPrompt = `${userPrompt} という状況を想定した、危険予知訓練（KYT）のシナリオを作成してください。以下の3つの要素を必ず含めてください。
1. **【状況】:** 具体的な情景が目に浮かぶように、詳細に記述してください。
2. **【危険のポイント】:** 特に振動工具の使用に関連するリスク（レイノー現象、握力低下、血行不良など）を最低1つは含めて、具体的に指摘してください。二次災害のリスクにも言及してください。
3. **【対策案】:** 危険を回避するための具体的な行動を複数提案してください。`;

        try {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: fullPrompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };
            
            const result = await fetchWithBackoff(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (text) {
                kytResultText.textContent = text;
                kytResultContainer.style.display = 'block';
            } else {
                throw new Error("No text generated in API response.");
            }
        } catch (error) {
            console.error("Error generating KYT scenario:", error);
            kytResultText.textContent = "シナリオの生成中にエラーが発生しました。しばらくしてからもう一度お試しください。";
            kytResultContainer.style.display = 'block';
        } finally {
            generateKytBtn.disabled = false;
            generateKytBtn.classList.remove('loading');
            kytLoader.style.display = 'none';
        }
    }

    // --- Event Listeners Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault(); // Prevent space from scrolling page
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                prevSlide();
            }
        });

        // Click Navigation
        if(prevBtn) {
            prevBtn.addEventListener('click', prevSlide);
        }
        if(nextBtn) {
            nextBtn.addEventListener('click', nextSlide);
        }

        // Gemini Feature Buttons
        if (generateKytBtn) {
            generateKytBtn.addEventListener('click', handleGenerateKyt);
        }
        readAloudBtns.forEach(btn => {
            btn.addEventListener('click', handleReadAloudClick);
        });

        // Show the first slide initially
        showSlide(0);
    });
</script>

</body>
</html>


