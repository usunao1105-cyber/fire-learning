<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUIBO-GUARD - 水防活動支援システム</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (JSX変換用) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* アニメーション用カスタムスタイル */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideInFromTop {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-in {
            animation: fadeIn 0.3s ease-out;
        }
        .slide-in-from-top-2 {
            animation: slideInFromTop 0.2s ease-out;
        }
        .slide-in-from-top-4 {
            animation: slideInFromTop 0.4s ease-out;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- アイコンコンポーネント定義 (Lucide IconsのSVGパスを使用) ---
        const IconBase = ({ children, color = "currentColor", size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const AlertTriangle = (props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></IconBase>;
        const Users = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const ClipboardList = (props) => <IconBase {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></IconBase>;
        const Wind = (props) => <IconBase {...props}><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></IconBase>;
        const Waves = (props) => <IconBase {...props}><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/></IconBase>;
        const Clock = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;
        const ShieldAlert = (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></IconBase>;
        const Radio = (props) => <IconBase {...props}><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></IconBase>;
        const UserCheck = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></IconBase>;
        const Menu = (props) => <IconBase {...props}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Plus = (props) => <IconBase {...props}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const Edit2 = (props) => <IconBase {...props}><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></IconBase>;
        const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;

        // --- アプリケーション本体 ---
        const SuiboGuardApp = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showMenu, setShowMenu] = useState(false);
            
            // モーダル管理用State
            const [showResetConfirm, setShowResetConfirm] = useState(false);
            const [memberToDelete, setMemberToDelete] = useState(null);

            // 災害名（ミッション名）
            const [missionTitle, setMissionTitle] = useState('');

            // 役職リスト
            const ROLES = ['団長', '副団長', '分団長', '副分団長', '部長', '班長', '団員'];

            // 初期データ定数
            const INITIAL_MEMBERS = [];

            const INITIAL_LOGS = [
                { id: 1, time: '18:00', from: '本部', type: 'command', content: '水防警報発令。各分団は待機せよ。' },
            ];

            const INITIAL_REPORT = {
                waterLevel: 'normal',
                smell: 'none',
                driftwood: 'none',
                rain: 'light',
            };

            const INITIAL_SAFETY = {
                lifeJacket: false,
                boots: false,
                light: false,
                retreatRoute: false,
            };

            // State
            const [members, setMembers] = useState(INITIAL_MEMBERS);
            const [logs, setLogs] = useState(INITIAL_LOGS);
            const [report, setReport] = useState(INITIAL_REPORT);
            const [safetyChecks, setSafetyChecks] = useState(INITIAL_SAFETY);

            // 編集用State
            const [newMemberName, setNewMemberName] = useState('');
            const [newMemberRole, setNewMemberRole] = useState('団員');
            const [isAddingMember, setIsAddingMember] = useState(false);
            
            // メンバー編集モード用
            const [editingMemberId, setEditingMemberId] = useState(null);
            const [editName, setEditName] = useState('');
            const [editRole, setEditRole] = useState('');

            // 現在時刻の取得
            const [currentTime, setCurrentTime] = useState(new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));

            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                }, 60000);
                return () => clearInterval(timer);
            }, []);

            // データリセット処理
            const resetAllData = () => {
                setMembers(INITIAL_MEMBERS);
                setLogs(INITIAL_LOGS);
                setReport(INITIAL_REPORT);
                setSafetyChecks(INITIAL_SAFETY);
                setMissionTitle('');
                setShowResetConfirm(false);
                setShowMenu(false);
                setActiveTab('dashboard');
            };

            // 団員追加処理
            const addMember = () => {
                if (!newMemberName.trim()) return;
                const newId = members.length > 0 ? Math.max(...members.map(m => m.id)) + 1 : 1;
                const newMember = {
                    id: newId,
                    name: newMemberName,
                    role: newMemberRole,
                    status: 'standby'
                };
                setMembers([...members, newMember]);
                setNewMemberName('');
                setNewMemberRole('団員');
                setIsAddingMember(false);
                addLog('システム', 'status', `${newMemberName} (${newMemberRole}) を名簿に追加しました`);
            };

            // 団員削除確認処理（モーダル表示）
            const confirmDeleteMember = (member) => {
                setMemberToDelete(member);
            };

            // 団員削除実行
            const executeDeleteMember = () => {
                if (memberToDelete) {
                    setMembers(members.filter(m => m.id !== memberToDelete.id));
                    addLog('システム', 'status', `${memberToDelete.name} を名簿から削除しました`);
                    setMemberToDelete(null);
                }
            };

            // 編集開始
            const startEditing = (member) => {
                setEditingMemberId(member.id);
                setEditName(member.name);
                setEditRole(member.role);
            };

            // 編集保存
            const saveEditing = () => {
                setMembers(members.map(m => 
                    m.id === editingMemberId ? { ...m, name: editName, role: editRole } : m
                ));
                setEditingMemberId(null);
            };

            // 編集キャンセル
            const cancelEditing = () => {
                setEditingMemberId(null);
            };

            // 団員ステータス変更
            const updateMemberStatus = (id, newStatus) => {
                setMembers(members.map(m => m.id === id ? { ...m, status: newStatus } : m));
                const member = members.find(m => m.id === id);
                if(member) {
                    addLog('システム', 'status', `${member.name} の状態を ${getStatusText(newStatus)} に変更`);
                }
            };

            // ログ追加
            const addLog = (from, type, content) => {
                const newLog = {
                    id: logs.length + 1,
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    from,
                    type,
                    content
                };
                setLogs([newLog, ...logs]);
            };

            // 危険度判定ロジック
            const getDangerLevel = () => {
                if (report.waterLevel === 'critical' || report.smell === 'burning') return { level: '撤退推奨', color: 'bg-red-600', text: 'text-white', animate: 'animate-pulse' };
                if (report.waterLevel === 'dangerous' || report.smell === 'muddy' || report.driftwood === 'many') return { level: '警戒', color: 'bg-orange-500', text: 'text-white', animate: '' };
                if (report.waterLevel === 'warning') return { level: '注意', color: 'bg-yellow-400', text: 'text-black', animate: '' };
                return { level: '平常', color: 'bg-green-500', text: 'text-white', animate: '' };
            };

            const dangerStatus = getDangerLevel();

            // ステータス表示用ヘルパー
            const getStatusText = (status) => {
                switch(status) {
                    case 'standby': return '待機中';
                    case 'active': return '活動中';
                    case 'rest': return '休憩中';
                    case 'retreat': return '撤退済';
                    default: return status;
                }
            };

            const getStatusColor = (status) => {
                switch(status) {
                    case 'standby': return 'bg-gray-200 text-gray-800';
                    case 'active': return 'bg-blue-600 text-white';
                    case 'rest': return 'bg-green-500 text-white';
                    case 'retreat': return 'bg-purple-600 text-white';
                    default: return 'bg-gray-100';
                }
            };

            // コンポーネント: ダッシュボード
            const Dashboard = () => (
                <div className="space-y-4">
                    <div className="bg-white p-3 rounded-lg shadow-sm border border-gray-200">
                        <label className="block text-xs font-bold text-gray-500 mb-1">災害・出動件名</label>
                        <input
                            type="text"
                            value={missionTitle}
                            onChange={(e) => setMissionTitle(e.target.value)}
                            placeholder="例：台風〇号の大雨警報に伴う警戒出動"
                            className="w-full text-lg font-bold border-b-2 border-gray-300 focus:border-blue-500 outline-none placeholder-gray-300 py-1"
                        />
                    </div>

                    <div className={`p-4 rounded-xl shadow-lg flex items-center justify-between ${dangerStatus.color} ${dangerStatus.text} ${dangerStatus.animate}`}>
                        <div>
                            <h2 className="text-sm opacity-90">現在の現場判定</h2>
                            <p className="text-3xl font-bold flex items-center gap-2">
                                <AlertTriangle /> {dangerStatus.level}
                            </p>
                        </div>
                        <div className="text-right">
                            <p className="text-sm">現在時刻</p>
                            <p className="text-2xl font-mono">{currentTime}</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-3">
                        <div className="bg-white p-4 rounded-lg shadow border border-gray-200 cursor-pointer" onClick={() => setActiveTab('members')}>
                            <div className="flex justify-between items-start mb-2">
                                <Users className="text-blue-600" />
                                <span className="text-2xl font-bold">{members.filter(m => m.status === 'active').length} <span className="text-sm font-normal text-gray-500">/ {members.length}</span></span>
                            </div>
                            <p className="text-sm text-gray-600">活動中隊員</p>
                        </div>
                        <div className="bg-white p-4 rounded-lg shadow border border-gray-200 cursor-pointer" onClick={() => setActiveTab('logs')}>
                            <div className="flex justify-between items-start mb-2">
                                <Radio className="text-red-500" />
                                <span className="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded-full">最新</span>
                            </div>
                            <p className="text-sm font-medium line-clamp-2">{logs[0]?.content}</p>
                        </div>
                    </div>

                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h3 className="font-bold text-blue-800 flex items-center gap-2 mb-2">
                            <ShieldAlert size={18} /> 安全の鉄則
                        </h3>
                        <ul className="text-sm text-blue-800 space-y-1 list-disc pl-4">
                            <li>水位が<strong>計画高水位</strong>に達したら作業中止・撤退</li>
                            <li><strong>土臭い・焦げ臭い</strong>においは土石流の前兆</li>
                            <li>ウェーダー禁止、<strong>固型式ライフジャケット</strong>着用</li>
                        </ul>
                    </div>

                    <div className="grid grid-cols-1 gap-3">
                        <button 
                            onClick={() => setActiveTab('report')}
                            className="bg-indigo-600 text-white p-4 rounded-xl font-bold text-lg shadow-md active:bg-indigo-700 transition flex items-center justify-center gap-2"
                        >
                            <ClipboardList /> 現場状況報告・チェック
                        </button>
                    </div>
                </div>
            );

            // コンポーネント: 隊員管理
            const MemberManager = () => (
                <div className="space-y-4">
                    <div className="flex justify-between items-center mb-2">
                        <h2 className="text-xl font-bold text-gray-800">出動隊員名簿</h2>
                        <span className="text-sm text-gray-500">計 {members.length} 名</span>
                    </div>

                    {isAddingMember ? (
                        <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 shadow-sm animate-in fade-in slide-in-from-top-4">
                            <h3 className="font-bold text-blue-800 mb-3 flex items-center gap-2"><UserCheck size={18}/> 隊員の追加</h3>
                            <div className="space-y-3">
                                <div>
                                    <label className="block text-xs text-gray-600 mb-1">役職</label>
                                    <select 
                                        value={newMemberRole} 
                                        onChange={(e) => setNewMemberRole(e.target.value)}
                                        className="w-full p-2 rounded border border-gray-300 font-bold"
                                    >
                                        {ROLES.map(role => (
                                            <option key={role} value={role}>{role}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs text-gray-600 mb-1">氏名</label>
                                    <input 
                                        type="text" 
                                        value={newMemberName}
                                        onChange={(e) => setNewMemberName(e.target.value)}
                                        placeholder="氏名を入力"
                                        className="w-full p-2 rounded border border-gray-300"
                                    />
                                </div>
                                <div className="flex gap-2 pt-2">
                                    <button onClick={() => setIsAddingMember(false)} className="flex-1 bg-gray-200 text-gray-700 py-2 rounded font-bold">キャンセル</button>
                                    <button onClick={addMember} className="flex-1 bg-blue-600 text-white py-2 rounded font-bold flex justify-center items-center gap-1"><Save size={16}/> 追加</button>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <button 
                            onClick={() => setIsAddingMember(true)}
                            className="w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 font-bold hover:bg-gray-50 flex items-center justify-center gap-2"
                        >
                            <Plus size={20} /> 隊員を追加する
                        </button>
                    )}
                    
                    {members.length === 0 && !isAddingMember && (
                        <div className="text-center py-10 text-gray-400">
                            <p>出動隊員が登録されていません。<br/>「隊員を追加する」から登録してください。</p>
                        </div>
                    )}

                    <div className="space-y-3">
                        {members.map(member => (
                            <div key={member.id} className="bg-white p-4 rounded-lg shadow border border-gray-200 relative">
                                
                                {editingMemberId === member.id ? (
                                    <div className="mb-3 p-2 bg-blue-50 rounded border border-blue-200">
                                        <div className="space-y-2 mb-2">
                                            <div>
                                                <label className="text-xs text-gray-500">役職</label>
                                                <select 
                                                    value={editRole} 
                                                    onChange={(e) => setEditRole(e.target.value)}
                                                    className="w-full p-1 rounded border font-bold"
                                                >
                                                    {ROLES.map(role => <option key={role} value={role}>{role}</option>)}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="text-xs text-gray-500">氏名</label>
                                                <input 
                                                    type="text" 
                                                    value={editName}
                                                    onChange={(e) => setEditName(e.target.value)}
                                                    className="w-full p-1 rounded border font-bold"
                                                />
                                            </div>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={cancelEditing} className="flex-1 py-1 bg-gray-200 rounded text-xs font-bold">キャンセル</button>
                                            <button onClick={saveEditing} className="flex-1 py-1 bg-blue-600 text-white rounded text-xs font-bold">保存</button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex justify-between items-center mb-3 pr-16">
                                        <div>
                                            <span className="text-xs font-bold bg-gray-100 px-2 py-1 rounded text-gray-600 mr-2">{member.role}</span>
                                            <span className="text-lg font-bold">{member.name}</span>
                                        </div>
                                        <span className={`px-3 py-1 rounded-full text-xs font-bold ${getStatusColor(member.status)}`}>
                                            {getStatusText(member.status)}
                                        </span>
                                    </div>
                                )}

                                {editingMemberId !== member.id && (
                                    <div className="absolute top-2 right-2 flex gap-1">
                                        <button 
                                            onClick={() => startEditing(member)}
                                            className="p-2 text-gray-400 hover:text-blue-500 hover:bg-blue-50 rounded"
                                            title="編集"
                                        >
                                            <Edit2 size={16} />
                                        </button>
                                        <button 
                                            onClick={() => confirmDeleteMember(member)}
                                            className="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded"
                                            title="削除"
                                        >
                                            <Trash2 size={16} />
                                        </button>
                                    </div>
                                )}
                                
                                {editingMemberId !== member.id && (
                                    <div className="grid grid-cols-4 gap-2">
                                        <button 
                                            onClick={() => updateMemberStatus(member.id, 'standby')}
                                            className={`p-2 rounded text-xs font-bold ${member.status === 'standby' ? 'bg-gray-600 text-white' : 'bg-gray-100 text-gray-600'}`}
                                        >
                                            待機
                                        </button>
                                        <button 
                                            onClick={() => updateMemberStatus(member.id, 'active')}
                                            className={`p-2 rounded text-xs font-bold ${member.status === 'active' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'}`}
                                        >
                                            活動
                                        </button>
                                        <button 
                                            onClick={() => updateMemberStatus(member.id, 'rest')}
                                            className={`p-2 rounded text-xs font-bold ${member.status === 'rest' ? 'bg-green-600 text-white' : 'bg-gray-100 text-gray-600'}`}
                                        >
                                            休憩
                                        </button>
                                        <button 
                                            onClick={() => updateMemberStatus(member.id, 'retreat')}
                                            className={`p-2 rounded text-xs font-bold ${member.status === 'retreat' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-600'}`}
                                        >
                                            撤退
                                        </button>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );

            // コンポーネント: 現場レポート
            const FieldReport = () => (
                <div className="space-y-6 pb-20">
                    <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4">
                        <h3 className="font-bold text-yellow-800 mb-2">安全管理チェック</h3>
                        <div className="space-y-3">
                            <label className="flex items-center space-x-3 bg-white p-3 rounded shadow-sm">
                                <input 
                                    type="checkbox" 
                                    checked={safetyChecks.lifeJacket}
                                    onChange={() => setSafetyChecks({...safetyChecks, lifeJacket: !safetyChecks.lifeJacket})}
                                    className="w-6 h-6 text-blue-600"
                                />
                                <span className="text-gray-800 font-medium">固型式ライフジャケット着用</span>
                            </label>
                            <label className="flex items-center space-x-3 bg-white p-3 rounded shadow-sm">
                                <input 
                                    type="checkbox" 
                                    checked={safetyChecks.boots}
                                    onChange={() => setSafetyChecks({...safetyChecks, boots: !safetyChecks.boots})}
                                    className="w-6 h-6 text-blue-600"
                                />
                                <span className="text-gray-800 font-medium">長靴着用 (ウェーダー禁止)</span>
                            </label>
                            <label className="flex items-center space-x-3 bg-white p-3 rounded shadow-sm">
                                <input 
                                    type="checkbox" 
                                    checked={safetyChecks.retreatRoute}
                                    onChange={() => setSafetyChecks({...safetyChecks, retreatRoute: !safetyChecks.retreatRoute})}
                                    className="w-6 h-6 text-blue-600"
                                />
                                <span className="text-gray-800 font-medium">撤退ルートの確保・確認</span>
                            </label>
                        </div>
                    </div>

                    <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                        <Wind /> 現場の予兆チェック
                    </h2>

                    <div className="bg-white p-4 rounded-lg shadow">
                        <label className="block text-sm font-bold text-gray-700 mb-3">川からの「におい」は？</label>
                        <div className="grid grid-cols-3 gap-2">
                            <button 
                                onClick={() => setReport({...report, smell: 'none'})}
                                className={`p-3 rounded-lg border-2 font-bold ${report.smell === 'none' ? 'border-green-500 bg-green-50 text-green-700' : 'border-gray-200 text-gray-600'}`}
                            >
                                異臭なし
                            </button>
                            <button 
                                onClick={() => setReport({...report, smell: 'muddy'})}
                                className={`p-3 rounded-lg border-2 font-bold ${report.smell === 'muddy' ? 'border-orange-500 bg-orange-50 text-orange-700' : 'border-gray-200 text-gray-600'}`}
                            >
                                土臭い
                                <span className="block text-xs font-normal mt-1">(上流崩壊?)</span>
                            </button>
                            <button 
                                onClick={() => setReport({...report, smell: 'burning'})}
                                className={`p-3 rounded-lg border-2 font-bold ${report.smell === 'burning' ? 'border-red-600 bg-red-50 text-red-700 animate-pulse' : 'border-gray-200 text-gray-600'}`}
                            >
                                きな臭い
                                <span className="block text-xs font-normal mt-1">(土石流兆候)</span>
                            </button>
                        </div>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow">
                        <label className="block text-sm font-bold text-gray-700 mb-3">流木の量は？</label>
                        <div className="grid grid-cols-3 gap-2">
                            <button 
                                onClick={() => setReport({...report, driftwood: 'none'})}
                                className={`p-3 rounded-lg border-2 font-bold ${report.driftwood === 'none' ? 'border-green-500 bg-green-50 text-green-700' : 'border-gray-200 text-gray-600'}`}
                            >
                                なし
                            </button>
                            <button 
                                onClick={() => setReport({...report, driftwood: 'few'})}
                                className={`p-3 rounded-lg border-2 font-bold ${report.driftwood === 'few' ? 'border-yellow-500 bg-yellow-50 text-yellow-700' : 'border-gray-200 text-gray-600'}`}
                            >
                                少しある
                            </button>
                            <button 
                                onClick={() => setReport({...report, driftwood: 'many'})}
                                className={`p-3 rounded-lg border-2 font-bold ${report.driftwood === 'many' ? 'border-red-500 bg-red-50 text-red-700' : 'border-gray-200 text-gray-600'}`}
                            >
                                大量
                                <span className="block text-xs font-normal mt-1">(橋脚閉塞注意)</span>
                            </button>
                        </div>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow">
                        <label className="block text-sm font-bold text-gray-700 mb-3">目視水位</label>
                        <div className="space-y-2">
                            <button 
                                onClick={() => setReport({...report, waterLevel: 'normal'})}
                                className={`w-full p-3 rounded-lg border-2 font-bold text-left ${report.waterLevel === 'normal' ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-gray-200'}`}
                            >
                                平常～警戒水位未満
                            </button>
                            <button 
                                onClick={() => setReport({...report, waterLevel: 'warning'})}
                                className={`w-full p-3 rounded-lg border-2 font-bold text-left ${report.waterLevel === 'warning' ? 'border-yellow-500 bg-yellow-50 text-yellow-700' : 'border-gray-200'}`}
                            >
                                計画高水位に近づいている
                            </button>
                            <button 
                                onClick={() => setReport({...report, waterLevel: 'critical'})}
                                className={`w-full p-3 rounded-lg border-2 font-bold text-left ${report.waterLevel === 'critical' ? 'border-red-600 bg-red-600 text-white' : 'border-gray-200'}`}
                            >
                                計画高水位 到達
                                <span className="block text-sm font-normal opacity-90">※直ちに作業中止・全員撤退</span>
                            </button>
                        </div>
                    </div>

                    <button 
                        onClick={() => {
                            addLog('現場班長', 'report', `状況報告: におい[${report.smell}] 流木[${report.driftwood}] 水位[${report.waterLevel}]`);
                            setActiveTab('logs');
                        }}
                        className="w-full bg-blue-600 text-white p-4 rounded-xl font-bold text-lg shadow-lg active:bg-blue-700"
                    >
                        状況を本部に送信・記録
                    </button>
                </div>
            );

            // コンポーネント: 指示・ログ管理
            const CommandLogs = () => {
                const [commander, setCommander] = useState('');
                const [commandText, setCommandText] = useState('');

                const handleSubmit = (e) => {
                    e.preventDefault();
                    if (!commander || !commandText) return;
                    addLog(commander, 'command', commandText);
                    setCommandText('');
                };

                return (
                    <div className="space-y-4 pb-20">
                        <div className="bg-white p-4 rounded-lg shadow border-l-4 border-blue-600">
                            <h2 className="font-bold text-gray-800 mb-3">新規指示・記録の入力</h2>
                            <form onSubmit={handleSubmit} className="space-y-3">
                                <div>
                                    <label className="block text-xs text-gray-500 mb-1">誰の指示・発言ですか？</label>
                                    <select 
                                        value={commander} 
                                        onChange={(e) => setCommander(e.target.value)}
                                        className="w-full p-3 bg-gray-50 rounded border border-gray-300 font-bold"
                                    >
                                        <option value="">選択してください</option>
                                        {ROLES.map(role => (
                                            <option key={role} value={role}>{role}</option>
                                        ))}
                                        <option value="本部">本部 (市町村長/本部長)</option>
                                        <option value="現場指揮官">現場指揮官</option>
                                        <option value="警察・消防署">警察・消防署</option>
                                    </select>
                                </div>
                                <div>
                                    <textarea 
                                        value={commandText}
                                        onChange={(e) => setCommandText(e.target.value)}
                                        placeholder="指示内容を入力（例：土嚢積み開始、撤退指示など）"
                                        className="w-full p-3 bg-gray-50 rounded border border-gray-300 h-24"
                                    />
                                </div>
                                <button type="submit" className="w-full bg-blue-600 text-white py-3 rounded font-bold shadow">
                                    記録する
                                </button>
                            </form>
                        </div>

                        <div className="space-y-2">
                            <h3 className="font-bold text-gray-700 ml-1">履歴タイムライン</h3>
                            {logs.map((log) => (
                                <div key={log.id} className="bg-white p-3 rounded shadow-sm border-l-2 border-gray-300 flex gap-3">
                                    <div className="text-gray-500 text-xs font-mono min-w-[3rem] pt-1">{log.time}</div>
                                    <div className="flex-1">
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className={`text-xs px-2 py-0.5 rounded text-white ${log.type === 'command' ? 'bg-red-500' : log.type === 'report' ? 'bg-green-500' : 'bg-gray-500'}`}>
                                                {log.from}
                                            </span>
                                        </div>
                                        <p className="text-gray-800 text-sm">{log.content}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-100 font-sans text-gray-900 pb-20 max-w-md mx-auto shadow-2xl overflow-hidden relative">
                    <header className="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-md">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-lg font-bold flex items-center gap-2">
                                    <ShieldAlert className="text-yellow-400" /> SUIBO-GUARD
                                </h1>
                                <p className="text-xs text-gray-400">水防活動支援システム</p>
                            </div>
                            <button onClick={() => setShowMenu(!showMenu)} className="p-2 relative">
                                {showMenu ? <X /> : <Menu />}
                            </button>
                        </div>

                        {showMenu && (
                            <div className="absolute top-full right-0 bg-white shadow-xl rounded-bl-xl w-64 p-2 text-gray-800 border-t z-50 animate-in fade-in slide-in-from-top-2">
                                <button 
                                    onClick={() => setShowResetConfirm(true)}
                                    className="w-full p-3 text-left flex items-center gap-2 text-red-600 hover:bg-red-50 rounded font-bold"
                                >
                                    <RotateCcw size={18} /> 全データをリセット
                                </button>
                            </div>
                        )}
                    </header>

                    <main className="p-4">
                        {activeTab === 'dashboard' && <Dashboard />}
                        {activeTab === 'members' && <MemberManager />}
                        {activeTab === 'report' && <FieldReport />}
                        {activeTab === 'logs' && <CommandLogs />}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around p-2 pb-6 max-w-md mx-auto z-40">
                        <button 
                            onClick={() => setActiveTab('dashboard')}
                            className={`flex flex-col items-center p-2 rounded-lg w-16 ${activeTab === 'dashboard' ? 'text-blue-600 bg-blue-50' : 'text-gray-500'}`}
                        >
                            <AlertTriangle size={24} />
                            <span className="text-[10px] mt-1 font-bold">ホーム</span>
                        </button>
                        <button 
                            onClick={() => setActiveTab('members')}
                            className={`flex flex-col items-center p-2 rounded-lg w-16 ${activeTab === 'members' ? 'text-blue-600 bg-blue-50' : 'text-gray-500'}`}
                        >
                            <Users size={24} />
                            <span className="text-[10px] mt-1 font-bold">隊員</span>
                        </button>
                        <button 
                            onClick={() => setActiveTab('report')}
                            className={`flex flex-col items-center p-2 rounded-lg w-16 ${activeTab === 'report' ? 'text-blue-600 bg-blue-50' : 'text-gray-500'}`}
                        >
                            <Waves size={24} />
                            <span className="text-[10px] mt-1 font-bold">報告</span>
                        </button>
                        <button 
                            onClick={() => setActiveTab('logs')}
                            className={`flex flex-col items-center p-2 rounded-lg w-16 ${activeTab === 'logs' ? 'text-blue-600 bg-blue-50' : 'text-gray-500'}`}
                        >
                            <Clock size={24} />
                            <span className="text-[10px] mt-1 font-bold">履歴</span>
                        </button>
                    </nav>
                    
                    {dangerStatus.level === '撤退推奨' && (
                        <div className="fixed top-20 left-4 right-4 bg-red-600 text-white p-4 rounded-lg shadow-2xl z-50 animate-bounce text-center border-4 border-white">
                            <h2 className="text-2xl font-bold mb-1">⚠️ 直ちに撤退せよ</h2>
                            <p className="font-bold">計画高水位超過、または土石流の予兆あり。</p>
                            <p className="text-sm mt-2">安全な高台へ移動し、点呼を行ってください。</p>
                        </div>
                    )}

                    {memberToDelete && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-lg p-6 max-w-sm w-full shadow-2xl">
                                <h3 className="text-lg font-bold text-gray-800 mb-2">隊員の削除確認</h3>
                                <p className="text-gray-600 mb-4">
                                    <strong>{memberToDelete.name}</strong> を名簿から削除しますか？
                                    <br/><span className="text-xs text-red-500">※この操作は取り消せません。</span>
                                </p>
                                <div className="flex gap-3">
                                    <button 
                                        onClick={() => setMemberToDelete(null)}
                                        className="flex-1 py-2 bg-gray-200 text-gray-700 rounded font-bold"
                                    >
                                        キャンセル
                                    </button>
                                    <button 
                                        onClick={executeDeleteMember}
                                        className="flex-1 py-2 bg-red-600 text-white rounded font-bold"
                                    >
                                        削除する
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showResetConfirm && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-lg p-6 max-w-sm w-full shadow-2xl">
                                <h3 className="text-lg font-bold text-gray-800 mb-2 flex items-center gap-2"><AlertTriangle className="text-red-500"/> データ初期化</h3>
                                <p className="text-gray-600 mb-4">
                                    名簿、ログ、報告内容など、<strong>全てのデータを初期状態に戻しますか？</strong>
                                    <br/><span className="text-xs text-red-500">※現在の入力内容はすべて消えます。</span>
                                </p>
                                <div className="flex gap-3">
                                    <button 
                                        onClick={() => setShowResetConfirm(false)}
                                        className="flex-1 py-2 bg-gray-200 text-gray-700 rounded font-bold"
                                    >
                                        キャンセル
                                    </button>
                                    <button 
                                        onClick={resetAllData}
                                        className="flex-1 py-2 bg-red-600 text-white rounded font-bold"
                                    >
                                        リセット
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SuiboGuardApp />);
    </script>
</body>
</html>
